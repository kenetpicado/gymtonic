import{C as c,_ as w}from"./AppLayout-35c1889e.js";import{_ as q}from"./Checkbox-1d7f6d0f.js";import{_ as f}from"./InputForm-943a80c4.js";import{_ as B}from"./SelectForm-e36d72ca.js";import{_ as E}from"./FormSection-484f9562.js";import{_ as F}from"./PrimaryButton-1a2d1e4a.js";import{_ as I}from"./SecondaryButton-ed9273fc.js";import{p as G}from"./periodLabel-28cc2bc8.js";import{t as L}from"./toast-532d1d63.js";import{j as O,T,p as V,m as A,o as m,f as z,w as n,a as r,b as i,d as _,t as l,u as s,c as v,k as D,F as N,h as Y,n as H}from"./app-9474134e.js";import"./_plugin-vue_export-helper-c27b6911.js";const J=r("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Plan ",-1),K={class:"max-w-7xl mx-auto py-10 sm:px-6 lg:px-8"},M={class:"mt-3"},Q={class:"uppercase"},R={class:"uppercase"},W={class:"grid grid-cols-2 gap-4"},X=["value"],Z=r("option",{value:"",selected:""},"Seleccionar periodo",-1),ee=["value"],te={class:"grid grid-cols-2 gap-4"},ae={key:0,class:"mb-4"},se={class:"mb-3 text-indigo-400"},oe={class:"block col-span-4 mb-4"},de={class:"col-span-4 text-lg font-medium text-gray-900"},xe={__name:"Create",props:{services:{type:Object,required:!1},plan:{type:Object,required:!1},customer:{type:Object,required:!0},isCurrentActive:{type:Boolean,required:!0}},setup(u){var C,y,h,k,$,U,S;const o=u,x=O(!1),e=T({plan_id:(C=o.plan)==null?void 0:C.id,price:((y=o.plan)==null?void 0:y.price)??0,period:(h=o.plan)==null?void 0:h.period,start_date:o.isCurrentActive?c.create(o.plan.end_date).addDays(1).format():c.today(),end_date:(k=o.plan)==null?void 0:k.end_date,discount:(($=o.plan)==null?void 0:$.discount)??0,note:((U=o.plan)==null?void 0:U.note)??"",service_id:((S=o.plan)==null?void 0:S.service_id)??o.services[0].id,save_note:!1}),P=[{name:"Inicio",route:"dashboard.index"},{name:"Clientes",route:"dashboard.customers.index"},{name:"Pagar",route:"dashboard.customers.plans.create",params:[o.customer.id]}],p=V(()=>{var d;return((d=o.services.find(a=>a.id==e.service_id))==null?void 0:d.prices)??[]}),g=V(()=>{var d;return e.period?((d=p.value.find(a=>a.period==e.period))==null?void 0:d.value)-e.discount:0});A(()=>e.service_id,()=>{p.value.find(d=>d.period==e.period)||(e.period=p.value[p.value.length-1].period)},{immediate:!0}),A(()=>x.value,d=>{d?e.start_date=c.create(o.plan.end_date).addDays(1).format():e.start_date=c.today()});const b=V(()=>c.create(e.start_date).addPeriod(parseInt(e.period)).addDays(-1).format());function j(){e.price=g.value,e.end_date=b.value,e.post(route("dashboard.customers.plans.store",o.customer.id),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{L.success("Guardado")}})}return(d,a)=>(m(),z(w,{title:"Customer",breads:P},{header:n(()=>[J]),default:n(()=>[r("div",K,[i(E,{onSubmitted:j},{title:n(()=>[_(" Informacion del plan ")]),description:n(()=>[r("div",M,[_(" Cliente: "),r("span",Q,l(o.customer.name),1)]),r("div",null,[_(" Estado del plan: "),r("span",R,l(u.isCurrentActive?"Activo":"Expirado"),1)])]),form:n(()=>[r("div",W,[i(B,{modelValue:s(e).service_id,"onUpdate:modelValue":a[0]||(a[0]=t=>s(e).service_id=t),text:"Servicio",required:"",name:"service_id"},{default:n(()=>[(m(!0),v(N,null,D(u.services,t=>(m(),v("option",{value:t.id},l(t.name),9,X))),256))]),_:1},8,["modelValue"]),i(B,{modelValue:s(e).period,"onUpdate:modelValue":a[1]||(a[1]=t=>s(e).period=t),text:"Periodo",required:""},{default:n(()=>[Z,(m(!0),v(N,null,D(p.value,t=>(m(),v("option",{value:t.period},l(s(G)[t.period])+" - C$ "+l(t.value),9,ee))),256))]),_:1},8,["modelValue"])]),r("div",te,[i(f,{text:"Inicio del plan",modelValue:s(e).start_date,"onUpdate:modelValue":a[2]||(a[2]=t=>s(e).start_date=t),type:"date"},null,8,["modelValue"]),i(f,{text:"Fin del plan",modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=t=>b.value=t),type:"date",disabled:""},null,8,["modelValue"])]),!u.isCurrentActive&&u.plan?(m(),v("div",ae,[r("div",se," El plan anterior finalizÃ³ el "+l(s(c).create(u.plan.end_date).format("d/m/Y")),1),i(q,{checked:x.value,"onUpdate:checked":a[4]||(a[4]=t=>x.value=t),text:"Continuar el plan anterior",class:"col-span-4"},null,8,["checked"])])):Y("",!0),i(f,{text:"Descuento C$ (Beca)",modelValue:s(e).discount,"onUpdate:modelValue":a[5]||(a[5]=t=>s(e).discount=t),type:"number"},null,8,["modelValue"]),i(f,{text:"Nota",modelValue:s(e).note,"onUpdate:modelValue":a[6]||(a[6]=t=>s(e).note=t)},null,8,["modelValue"]),r("div",oe,[i(q,{checked:s(e).save_note,"onUpdate:checked":a[7]||(a[7]=t=>s(e).save_note=t),text:"Guardar en notas"},null,8,["checked"])]),r("div",de," Total: C$ "+l(g.value),1)]),actions:n(()=>[i(I,{onClick:a[8]||(a[8]=t=>d.$inertia.visit(d.route("dashboard.customers.index")))},{default:n(()=>[_(" Cancelar ")]),_:1}),i(F,{class:H({"opacity-25":s(e).processing}),disabled:s(e).processing},{default:n(()=>[_(" Guardar ")]),_:1},8,["class","disabled"])]),_:1})])]),_:1}))}};export{xe as default};
