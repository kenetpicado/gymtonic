var j=Object.defineProperty;var z=(n,e,t)=>e in n?j(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>(z(n,typeof e!="symbol"?e+"":e,t),t);import{C as E,_ as G}from"./AppLayout-614eddf2.js";import{_ as B}from"./FormSection-01ee759b.js";import{T as P,p as h,m as Y,o as c,f as A,w as a,a as u,b as d,d as m,u as r,i as L,n as D,c as _,F as g,k as F,t as f,O as I}from"./app-8985fe0f.js";import{_ as p}from"./InputForm-b927c86e.js";import{_ as x}from"./PrimaryButton-c9b80bfc.js";import{_ as y}from"./SelectForm-ddf9ddad.js";import{_ as T}from"./SecondaryButton-f490444e.js";import{S as M}from"./SectionBorder-b96124ef.js";import{t as C}from"./toast-de30f96f.js";import{p as H}from"./periodLabel-28cc2bc8.js";import{_ as J}from"./Checkbox-4805c14b.js";import"./_plugin-vue_export-helper-c27b6911.js";class K{constructor(e=null,t,b=!1){l(this,"plan_id");l(this,"price");l(this,"period");l(this,"start_date");l(this,"end_date");l(this,"discount");l(this,"note");l(this,"service_id");l(this,"save_note");l(this,"TODAY");this.TODAY=new E().format("Y-m-d"),this.plan_id=e==null?void 0:e.id,this.price=(e==null?void 0:e.price)??0,this.period=e==null?void 0:e.period,b?this.start_date=e==null?void 0:e.end_date:this.start_date=(e==null?void 0:e.start_date)??this.TODAY,this.end_date=e==null?void 0:e.end_date,this.discount=(e==null?void 0:e.discount)??0,this.note=(e==null?void 0:e.note)??"",this.service_id=(e==null?void 0:e.service_id)??t,this.save_note=!1}}const Q={class:"max-w-7xl mx-auto py-10 sm:px-6 lg:px-8"},R={class:"grid grid-cols-2 gap-6"},W=u("option",{value:"F"},"Femenino",-1),X=u("option",{value:"M"},"Masculino",-1),Z={key:0},ee={key:1},te=u("span",{class:"block mt-2"},null,-1),oe=u("br",null,null,-1),se={key:1},re={class:"grid grid-cols-2 gap-4"},de=["value"],ae=u("option",{value:"",selected:"",disabled:""},"Seleccionar periodo",-1),ie=["value"],ne={class:"grid grid-cols-2 gap-4"},le={class:"block col-span-4 mb-4"},ue={class:"col-span-4 text-lg font-medium text-gray-900"},ke={__name:"Create",props:{customer:{type:Object,required:!1},isNew:{type:Boolean,default:!0},services:{type:Object,required:!0}},setup(n){var $,U,w,N,O,q;const e=n,t=P({id:(($=e.customer)==null?void 0:$.id)??null,name:((U=e.customer)==null?void 0:U.name)??"",phone:((w=e.customer)==null?void 0:w.phone)??"",birth_date:((N=e.customer)==null?void 0:N.birth_date)??"",gender:((O=e.customer)==null?void 0:O.gender)??"F",...new K((q=e.customer)==null?void 0:q.plan,e.services[0].id)}),b=[{name:"Inicio",route:"dashboard.index"},{name:"Clientes",route:"dashboard.customers.index"},{name:e.isNew?"Crear":"Editar",route:"dashboard.customers.create"}],v=h(()=>{var i;return((i=e.services.find(o=>o.id==t.service_id))==null?void 0:i.prices)??[]}),k=h(()=>{var i;return t.period?((i=v.value.find(o=>o.period==t.period))==null?void 0:i.value)-t.discount:0});Y(()=>t.service_id,()=>{v.value.find(i=>i.period==t.period)||(t.period=v.value[v.value.length-1].period)},{immediate:!0});const V=h(()=>E.create(t.start_date).addPeriod(parseInt(t.period)).addDays(-1).format());function S(){t.price=k.value,t.end_date=V.value,e.isNew?t.post(route("dashboard.customers.store"),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{C.success("Cliente creado correctamente!"),I.get(route("dashboard.customers.index"))},onError:i=>{C.error(Object.values(i).flat().join(", "))}}):t.put(route("dashboard.customers.update",t.id),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{C.success("Cliente actualizado correctamente!"),I.get(route("dashboard.customers.index"))}})}return(i,o)=>(c(),A(G,{title:"Customer",breads:b},{default:a(()=>[u("div",Q,[d(B,{onSubmitted:S},{title:a(()=>[m(" Informacion del cliente ")]),description:a(()=>[m(" Datos personales del cliente ")]),form:a(()=>[u("div",R,[d(p,{text:"Nombre completo",name:"name",required:"",modelValue:r(t).name,"onUpdate:modelValue":o[0]||(o[0]=s=>r(t).name=s)},null,8,["modelValue"]),d(p,{text:"Celular",modelValue:r(t).phone,"onUpdate:modelValue":o[1]||(o[1]=s=>r(t).phone=s),type:"number"},null,8,["modelValue"]),d(p,{text:"Fecha de nacimiento",modelValue:r(t).birth_date,"onUpdate:modelValue":o[2]||(o[2]=s=>r(t).birth_date=s),type:"date"},null,8,["modelValue"]),d(y,{modelValue:r(t).gender,"onUpdate:modelValue":o[3]||(o[3]=s=>r(t).gender=s),text:"Genero",required:""},{default:a(()=>[W,X]),_:1},8,["modelValue"])])]),actions:a(()=>[d(r(L),{href:i.route("dashboard.customers.index")},{default:a(()=>[d(T,null,{default:a(()=>[m(" Cancelar ")]),_:1})]),_:1},8,["href"]),d(x,{class:D({"opacity-25":r(t).processing}),disabled:r(t).processing},{default:a(()=>[m(" Guardar ")]),_:1},8,["class","disabled"])]),_:1}),d(M),d(B,{onSubmitted:S},{title:a(()=>[m(" Informacion del Plan ")]),description:a(()=>[n.customer?(c(),_(g,{key:0},[n.customer.plan?(c(),_("div",ee,[m(" El usuario tiene un plan existente, se actualizará con los datos introducidos y también se actualizará el ingreso correspondiente. "),te,m(" Si en cambio desea crear un nuevo plan "),oe,d(x,{class:"mt-4",onClick:o[4]||(o[4]=s=>i.$inertia.visit(i.route("dashboard.customers.plans.create",n.customer.id)))},{default:a(()=>[m(" Haga click aqui ")]),_:1})])):(c(),_("div",Z," El usuario no tiene un plan creado, se procederá a crear uno nuevo con los datos ingresados. "))],64)):(c(),_("div",se," Ingrese los datos del plan para el cliente. "))]),form:a(()=>[u("div",re,[d(y,{modelValue:r(t).service_id,"onUpdate:modelValue":o[5]||(o[5]=s=>r(t).service_id=s),text:"Servicio",required:"",name:"service_id"},{default:a(()=>[(c(!0),_(g,null,F(n.services,s=>(c(),_("option",{value:s.id},f(s.name),9,de))),256))]),_:1},8,["modelValue"]),d(y,{modelValue:r(t).period,"onUpdate:modelValue":o[6]||(o[6]=s=>r(t).period=s),text:"Periodo",required:""},{default:a(()=>[ae,(c(!0),_(g,null,F(v.value,s=>(c(),_("option",{value:s.period},f(r(H)[s.period])+" - C$ "+f(s.value),9,ie))),256))]),_:1},8,["modelValue"])]),u("div",ne,[d(p,{text:"Inicio del plan",modelValue:r(t).start_date,"onUpdate:modelValue":o[7]||(o[7]=s=>r(t).start_date=s),type:"date"},null,8,["modelValue"]),d(p,{text:"Fin del plan",modelValue:V.value,"onUpdate:modelValue":o[8]||(o[8]=s=>V.value=s),type:"date",disabled:""},null,8,["modelValue"])]),d(p,{text:"Descuento C$ (Beca)",modelValue:r(t).discount,"onUpdate:modelValue":o[9]||(o[9]=s=>r(t).discount=s),type:"number"},null,8,["modelValue"]),d(p,{text:"Nota",modelValue:r(t).note,"onUpdate:modelValue":o[10]||(o[10]=s=>r(t).note=s)},null,8,["modelValue"]),u("div",le,[d(J,{checked:r(t).save_note,"onUpdate:checked":o[11]||(o[11]=s=>r(t).save_note=s),text:"Guardar en notas"},null,8,["checked"])]),u("div",ue," Total: C$ "+f(k.value),1)]),actions:a(()=>[d(T,{onClick:o[12]||(o[12]=s=>i.$inertia.visit(i.route("dashboard.customers.index")))},{default:a(()=>[m(" Cancelar ")]),_:1}),d(x,{class:D({"opacity-25":r(t).processing}),disabled:r(t).processing},{default:a(()=>[m(" Guardar ")]),_:1},8,["class","disabled"])]),_:1})])]),_:1}))}};export{ke as default};
